<html>
<head>
<title>Upgrade System</title>
<link rel="stylesheet" href="../../styles/site.css" type="text/css" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">.highlight { background: #FFFF40; }</style> 
<script type="text/javascript" src="../../highlight.js"></script></head>
<body onLoad="highlight();">
<table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#FFFFFF">
<tr>
<td valign="top" class="pagebody">

<h2>Upgrade System</h2>

<p>If there are no <a href="../Service_Designer_User_Interface/Error Pane.html">validation errors</a>, you can generate a SQL file that contains statements to change the database to fit the current product release requirements by selecting the <b>Upgrade System</b> command from the <b>Database</b> menu. It is necessary to check whether the system upgrade is required every time a new release of the product has been installed. The runtime AVM will not start if the database has not been upgraded.</p>

<p>Once you select the <b>Upgrade System</b> command, the <b>Upgrade SQL</b> dialog opens where you can specify the directory and the name of the generated file. Click the <b>Save</b> button to create the file.</p>

<p>If there are no system upgrades required, a dialog will inform you. Otherwise, once the SQL file is generated, connect to the appropriate database (use SQLPlus or another database utility) and run the SQL.</p>

<table cellpadding='5' width='85%' cellspacing='8px' class='noteMacro' border="0" align='center'>
  <colgroup>
  <col width='24' />
  <col /></colgroup>
  <tr>
  <td><b class="strong">Important note:</b><br />
    The generated SQL file <b>must</b> be examined and changed when needed by the database administrator. The upgrade command generates only the essential parts of the DDL commands, and not indexes, constraints, triggers or any other advanced DDL constructs. The Velocity Studio is not a database design tool and cannot be used as such. Running the SQL file generated by Velocity Studio without first checking its contents may damage your database. Once the upgrade scripts have been run, the database administrator will need to review the procedures, triggers and views, and recompile them, if required.</td>
  </tr>
</table>
<p>By default, this command generates one SQL <span class="confluenceTd">file. To have this command generate separate SQL script files for each logical schema, uncheck the <strong><a href="Preferences.html#generateUpgradeSQL">Generate upgrade SQL in one output file</a></strong> setting in   Velocity Studio's Preferences page.</span></p>
<p><strong>Note: </strong>When you add a new JAR file  in the <a href="../Metadata_Objects/Metadata Root/Metadata Root Templates.html">Library</a> and  upgrade the system, an invalid database error message may occur. You need to add a logical schema for the JAR file to  take  syatem upgrade. For example, if cwl_dbqueue.jar is a part of the loaded libraries, a new DBQUEUE logical schema must be added in the <a href="../../Configuration_Tool_User_Guide/Configure/System/Databases/logicalConnection.html">System Administration</a> application.</p>
<h3>Upgrade system through the command line</h3>
<p>You can generate the Update System output using a command line:</p>
<ul>
  <li>In Windows, use <tt>generateUpgradeSQL.cmd</tt></li>
  <li>In Unix or Linux, use <tt>generateUpgradeSQL.sh</tt></li>
  </ul>
<p>The following describes the syntax of the command-line interface and the available arguments. A shortcut command can be found in <b><strong>&lt;<em>installation_folder</em>&gt;</strong>\designer\env\generateUpgradeSQL.cmd</b>, and shown as follows. </p>
<div class="code">
  <div class="codeContent">
    <pre>
@echo off
if ""%1""=="""" goto echoSyntax
if ""%2""=="""" goto echoSyntax
if ""%3""=="""" goto echoSyntax
if ""%4""=="""" goto echoSyntax
if ""%5""=="""" goto echoSyntax
IF ""%1""==""-logFile"" (
set LOG_FILE=%2
set JDBC_URL=%3
set APP_NAME=%4
set APP_VERSION=%5
set META_DIR=%6
set SQL_FILE=%7
set SQL_FILE_OPTION=%8
) ELSE (
set JDBC_URL=%1
set APP_NAME=%2
set APP_VERSION=%3
set META_DIR=%4
set SQL_FILE=%5
set SQL_FILE_OPTION=%6
)

set CWOC_CLASSPATH=<span class="code-java">C:\14\14441</span>
set CLASSPATH=%CWOC_CLASSPATH%\designer\Designer.jar;^
%CWOC_CLASSPATH%\lib\oracle\ojdbc6.jar;^
%CWOC_CLASSPATH%\lib\oracle\orai18n.jar;^
%CWOC_CLASSPATH%\lib\oracle\orai18n-mapping.jar;^
%CWOC_CLASSPATH%\lib\ilog\sdworkflowmodeler.deployed.jar;^
%CWOC_CLASSPATH%\lib\jdic\JDICplus.jar;^
%CWOC_CLASSPATH%\lib\axis2\addressing-1.41.mar;^
%CWOC_CLASSPATH%\lib\axis2\rampart-1.5.mar;^
%CWOC_CLASSPATH%\lib\axis2\mex-1.4.1.mar;^
%CWOC_CLASSPATH%\lib\axis2\wstx-asl-3.2.4.jar;^
%CWOC_CLASSPATH%\lib\axis2\rampart-core-1.5.jar;^
%CWOC_CLASSPATH%\lib\axis2\rampart-policy-1.5.jar;

set JAVA_OPTS=-Xms1024m -Xmx1024m -XX:MaxPermSize=128m -Dcom.conceptwave.licenseDir="%CWOC_CLASSPATH%"\designer\env -Dcom.conceptwave.modules.path="%CWOC_CLASSPATH%"\modules
IF ""%1""==""-logFile"" (
"C:\Program Files\Java\jdk1.7.0_51\bin\java" %JAVA_OPTS% -cp "%CLASSPATH%" com.conceptwave.servicedesigner.ServiceDesigner -generateSql -logFile %LOG_FILE% -jdbc=%JDBC_URL% -app_name=%APP_NAME% -app_version=%APP_VERSION% -metadata_dir=%META_DIR% %SQL_FILE% %SQL_FILE_OPTION%
) ELSE (
"C:\Program Files\Java\jdk1.7.0_51\bin\java" %JAVA_OPTS% -cp "%CLASSPATH%" com.conceptwave.servicedesigner.ServiceDesigner -generateSql -jdbc=%JDBC_URL% -app_name=%APP_NAME% -app_version=%APP_VERSION% -metadata_dir=%META_DIR% %SQL_FILE% %SQL_FILE_OPTION%
)
goto end
:echoSyntax
echo -----------------------------------------------------------------------------
echo Syntax: 
echo generateUpgradeSQL [-logFile logFile] JDBC_URL application_name application_version metadata_dir sql_file output_in_one_file(true/false)
echo JDBC_URL could be user@host:port:sid,user@host:port/service_name or any jdbc url
echo Example: 
echo generateUpgradeSQL cw@localhost:1521:orcl ON V1.0 c:\metadata\ON c:\upgrade.sql true
echo generateUpgradeSQL "cw@oracle.jdbc.driver.OracleDriver;jdbc:oracle:thin:@(DESCRIPTION=(LOAD_BALANCE=on)(ADDRESS=(PROTOCOL=TCP)(HOST=localhost)(PORT=1521))(CONNECT_DATA=(SERVICE_NAME=orcl)))" ON V1.0 c:\metadata\ON c:\upgrade.sql
echo (refer to documentation for details.)
echo ------------------------------------------------------------------------------
:end
</pre>
  </div>
</div>
 <p><strong>Note</strong>: To generate an upgrade SQL file for the deployment, use the <em>metadata_dir</em> argument of this command to point to the <a href="Metadata Build Deployment JAR.html"> deployment jar</a> file instead of a metadata project's folder path. </p></td>
</tr>
</table>
</body>
</html>
